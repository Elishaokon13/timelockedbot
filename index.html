<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pi Network Time-Locked Bot</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
      :root {
          --primary: #6366f1;
          --primary-dark: #4f46e5;
          --primary-light: #a5b4fc;
          --success: #10b981;
          --success-dark: #059669;
          --error: #ef4444;
          --error-dark: #b91c1c;
          --bg-gradient: linear-gradient(135deg, #818cf8, #4f46e5);
          --card-shadow: 0 4px 12px rgba(99, 102, 241, 0.15);
          --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
          --border-radius: 1rem;
          --spacing-unit: 1rem;
      }
  
      * {
          margin: 0;
          padding: 0;
          box-sizing: border-box;
      }
  
      body {
          font-family: 'Inter', sans-serif;
          min-height: 100vh;
          background: var(--bg-gradient);
          display: flex;
          justify-content: center;
          align-items: center;
          padding: clamp(0.5rem, 3vw, 1rem);
          color: #1f2937;
          font-size: clamp(14px, 2.5vw, 16px);
      }
  
      .container {
          width: 100%;
          max-width: 800px;
          background: #fff;
          border-radius: var(--border-radius);
          box-shadow: var(--card-shadow);
          overflow: hidden;
          margin: clamp(0.5rem, 2vw, 1rem);
      }
  
      .header {
          padding: clamp(1rem, 5vw, 1.5rem);
          text-align: center;
          position: relative;
          background: linear-gradient(180deg, #f9fafb, #fff);
      }
  
      .header::after {
          content: '';
          position: absolute;
          bottom: 0;
          left: 10%;
          right: 10%;
          height: 1px;
          background: #e5e7eb;
      }
  
      .logo {
          width: clamp(2rem, 10vw, 3rem);
          height: clamp(2rem, 10vw, 3rem);
          background: var(--primary);
          border-radius: 50%;
          display: inline-flex;
          align-items: center;
          justify-content: center;
          margin-bottom: clamp(0.5rem, 2vw, 0.75rem);
          color: white;
          font-weight: 700;
          font-size: clamp(1rem, 5vw, 1.5rem);
      }
  
      h1 {
          color: #111827;
          font-size: clamp(1.25rem, 5vw, 1.75rem);
          font-weight: 700;
          letter-spacing: -0.025em;
      }
  
      h2 {
          color: #111827;
          font-size: clamp(1rem, 4vw, 1.25rem);
          font-weight: 600;
          margin-bottom: clamp(0.75rem, 3vw, 1rem);
      }
  
      .tab-container {
          padding: clamp(0.75rem, 4vw, 1.5rem);
      }
  
      .tab-buttons {
          display: flex;
          background: #f3f4f6;
          border-radius: calc(var(--border-radius) * 0.75);
          padding: 0.25rem;
          margin-bottom: clamp(0.75rem, 3vw, 1.25rem);
          position: relative;
          gap: 0.25rem;
          flex-wrap: nowrap;
      }
  
      .tab-button {
          flex: 1;
          padding: clamp(0.375rem, 1.5vw, 0.5rem);
          text-align: center;
          background: transparent;
          border: none;
          cursor: pointer;
          font-size: clamp(0.625rem, 2vw, 0.75rem);
          font-weight: 500;
          color: #6b7280;
          border-radius: calc(var(--border-radius) * 0.5);
          transition: var(--transition);
          min-width: 0;
          z-index: 2;
          white-space: nowrap;
      }
  
      .tab-button:hover {
          background: rgba(99, 102, 241, 0.1);
      }
  
      .tab-button.active {
          background: white;
          color: #111827;
          font-weight: 600;
          box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      }
  
      .tab-indicator {
          position: absolute;
          height: calc(100% - 0.5rem);
          width: calc(33.33% - 0.5rem);
          background: white;
          border-radius: calc(var(--border-radius) * 0.5);
          box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
          left: 0.25rem;
          top: 0.25rem;
          transition: var(--transition);
          z-index: 1;
      }
  
      .tab-button:nth-child(2).active ~ .tab-indicator {
          transform: translateX(100%);
      }
  
      .tab-button:nth-child(3).active ~ .tab-indicator {
          transform: translateX(200%);
      }
  
      .tab-content {
          display: none !important;
          padding: clamp(0.75rem, 4vw, 1.25rem);
          background: #f9fafb;
          border-radius: var(--border-radius);
          animation: fadeIn 0.3s ease;
      }
  
      .tab-content.active {
          display: block !important;
      }
  
      @keyframes fadeIn {
          from { opacity: 0; transform: translateY(10px); }
          to { opacity: 1; transform: translateY(0); }
      }
  
      label {
          display: block;
          margin-bottom: 0.5rem;
          font-size: clamp(0.75rem, 2.5vw, 0.875rem);
          font-weight: 500;
          color: #374151;
      }
  
      input[type="text"],
      input[type="number"],
      input[type="datetime-local"],
      textarea {
          width: 100%;
          padding: clamp(0.5rem, 2vw, 0.75rem);
          margin-bottom: clamp(0.75rem, 3vw, 1rem);
          border: 1px solid #e5e7eb;
          border-radius: calc(var(--border-radius) * 0.5);
          font-size: clamp(0.75rem, 2.5vw, 0.875rem);
          background: #fff;
          transition: var(--transition);
          font-family: 'Inter', sans-serif;
      }
  
      input:focus,
      textarea:focus {
          outline: none;
          border-color: var(--primary);
          box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
      }
  
      textarea {
          resize: vertical;
          min-height: 100px;
      }
  
      .button {
          width: 100%;
          padding: clamp(0.75rem, 3vw, 1rem);
          background: var(--primary);
          color: #fff;
          border: none;
          border-radius: calc(var(--border-radius) * 0.5);
          cursor: pointer;
          font-size: clamp(0.875rem, 2.5vw, 1rem);
          font-weight: 600;
          transition: var(--transition);
          display: flex;
          justify-content: center;
          align-items: center;
          gap: 0.5rem;
          touch-action: manipulation;
      }
  
      .button:hover {
          background: var(--primary-dark);
          transform: translateY(-2px);
          box-shadow: 0 4px 12px rgba(99, 102, 241, 0.2);
      }
  
      .button:active {
          transform: translateY(0);
      }
  
      .button-success {
          background: var(--success);
      }
  
      .button-success:hover {
          background: var(--success-dark);
          box-shadow: 0 4px 12px rgba(16, 185, 129, 0.2);
      }
  
      .result {
          margin-top: clamp(0.75rem, 3vw, 1rem);
          padding: clamp(0.5rem, 2vw, 0.75rem);
          border-radius: calc(var(--border-radius) * 0.5);
          display: none;
          font-size: clamp(0.75rem, 2.5vw, 0.875rem);
          animation: fadeIn 0.3s ease;
          line-height: 1.5;
      }
  
      .success {
          background: rgba(16, 185, 129, 0.1);
          color: #065f46;
          border-left: 4px solid var(--success);
      }
  
      .error {
          background: rgba(239, 68, 68, 0.1);
          color: #991b1b;
          border-left: 4px solid var(--error);
      }
  
      .loading {
          text-align: center;
          margin-top: clamp(0.75rem, 3vw, 1rem);
          display: none;
      }
  
      .loading-spinner {
          width: clamp(1rem, 5vw, 1.5rem);
          height: clamp(1rem, 5vw, 1.5rem);
          border: 3px solid rgba(99, 102, 241, 0.1);
          border-top: 3px solid var(--primary);
          border-radius: 50%;
          animation: spin 1s linear infinite;
          margin: 0 auto;
      }
  
      @keyframes spin {
          to { transform: rotate(360deg); }
      }
  
      .keypair-info {
          margin-top: clamp(0.5rem, 2vw, 0.75rem);
          background: white;
          border-radius: calc(var(--border-radius) * 0.5);
          padding: clamp(0.5rem, 2vw, 0.75rem);
          box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
      }
  
      .keypair-info p {
          margin: clamp(0.5rem, 2vw, 0.75rem) 0;
          font-size: clamp(0.75rem, 2.5vw, 0.875rem);
          color: #374151;
          word-break: break-all;
          display: flex;
          flex-direction: column;
          gap: 0.25rem;
      }
  
      .keypair-info strong {
          color: #111827;
          font-weight: 600;
          font-size: clamp(0.625rem, 2vw, 0.75rem);
          text-transform: uppercase;
          letter-spacing: 0.05em;
      }
  
      .keypair-info .key-value {
          padding: clamp(0.5rem, 2vw, 0.625rem);
          background: #f3f4f6;
          border-radius: calc(var(--border-radius) * 0.25);
          font-family: monospace;
          font-size: clamp(0.625rem, 2vw, 0.75rem);
          overflow-x: auto;
          white-space: nowrap;
      }
  
      .checkbox-container {
          margin-bottom: clamp(0.75rem, 3vw, 1rem);
          display: flex;
          align-items: center;
          gap: 0.5rem;
      }
  
      .checkbox-container label {
          margin: 0;
          font-size: clamp(0.75rem, 2.5vw, 0.875rem);
      }
  
      input[type="checkbox"] {
          width: clamp(1rem, 4vw, 1.125rem);
          height: clamp(1rem, 4vw, 1.125rem);
          accent-color: var(--primary);
          cursor: pointer;
      }
  
      #datetime {
          display: none;
      }
  
      .badge {
          display: inline-block;
          padding: clamp(0.25rem, 1vw, 0.375rem) clamp(0.5rem, 2vw, 0.625rem);
          border-radius: calc(var(--border-radius) * 0.25);
          font-size: clamp(0.625rem, 2vw, 0.75rem);
          font-weight: 500;
      }
  
      .badge-active, .badge-pending, .badge-completed {
          background: rgba(16, 185, 129, 0.1);
          color: var(--success-dark);
      }
  
      .badge-inactive, .badge-failed, .badge-cancelled {
          background: rgba(239, 68, 68, 0.1);
          color: var(--error-dark);
      }
  
      .copy-icon {
          cursor: pointer;
          color: #6b7280;
          transition: var(--transition);
          margin-left: 0.5rem;
          width: clamp(0.875rem, 3vw, 1rem);
          height: clamp(0.875rem, 3vw, 1rem);
      }
  
      .copy-icon:hover {
          color: var(--primary);
      }
  
      .flex-row {
          display: flex;
          align-items: center;
          gap: 0.5rem;
      }
  
      .tooltip {
          position: relative;
          display: inline-block;
      }
  
      .tooltip .tooltiptext {
          visibility: hidden;
          width: clamp(80px, 20vw, 120px);
          background-color: #374151;
          color: #fff;
          text-align: center;
          border-radius: calc(var(--border-radius) * 0.25);
          padding: clamp(0.25rem, 1vw, 0.375rem);
          position: absolute;
          z-index: 1;
          bottom: 125%;
          left: 50%;
          transform: translateX(-50%);
          opacity: 0;
          transition: opacity 0.3s;
          font-size: clamp(0.625rem, 2vw, 0.75rem);
          font-weight: 500;
      }
  
      .tooltip .tooltiptext::after {
          content: "";
          position: absolute;
          top: 100%;
          left: 50%;
          margin-left: -5px;
          border-width: 5px;
          border-style: solid;
          border-color: #374151 transparent transparent transparent;
      }
  
      .tooltip:hover .tooltiptext {
          visibility: visible;
          opacity: 1;
      }
  
      .table-container {
          width: 100%;
          overflow-x: auto;
          margin-top: clamp(0.5rem, 2vw, 0.75rem);
          border-radius: var(--border-radius);
          background: white;
          box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
      }
  
      .transactions-table {
          width: 100%;
          border-collapse: collapse;
          font-size: clamp(0.75rem, 2.5vw, 0.875rem);
          min-width: 500px;
      }
  
      .transactions-table th,
      .transactions-table td {
          padding: clamp(0.5rem, 2vw, 0.75rem);
          text-align: left;
          border-bottom: 1px solid #e5e7eb;
      }
  
      .transactions-table th {
          font-weight: 600;
          color: #111827;
          background: #f3f4f6;
          position: sticky;
          top: 0;
          z-index: 1;
      }
  
      .transactions-table td {
          color: #374151;
      }
  
      .transactions-table .status {
          text-transform: capitalize;
      }
  
      .transactions-table .destination {
          font-family: monospace;
          max-width: clamp(100px, 20vw, 150px);
          overflow: hidden;
          text-overflow: ellipsis;
          white-space: nowrap;
      }
  
      .transaction-cards {
          display: none;
          flex-direction: column;
          gap: clamp(0.5rem, 2vw, 0.75rem);
          margin-top: clamp(0.5rem, 2vw, 0.75rem);
      }
  
      .transaction-card {
          background: white;
          border-radius: calc(var(--border-radius) * 0.5);
          padding: clamp(0.5rem, 2vw, 0.75rem);
          box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
          transition: var(--transition);
      }
  
      .transaction-card:hover {
          transform: translateY(-2px);
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }
  
      .transaction-card-row {
          display: flex;
          justify-content: space-between;
          margin-bottom: clamp(0.25rem, 1vw, 0.375rem);
          font-size: clamp(0.75rem, 2.5vw, 0.875rem);
      }
  
      .transaction-card-label {
          font-weight: 600;
          color: #111827;
      }
  
      .transaction-card-value {
          color: #374151;
          text-align: right;
          word-break: break-word;
          max-width: 60%;
      }
  
      .tab-button:focus,
      .button:focus,
      .copy-icon:focus {
          outline: 2px solid var(--primary);
          outline-offset: 2px;
      }
  
      @media (max-width: 768px) {
          .container {
              max-width: 100%;
          }
  
          .tab-container,
          .tab-content {
              padding: clamp(0.5rem, 3vw, 1rem);
          }
  
          .tab-button {
              padding: clamp(0.375rem, 1.5vw, 0.5rem);
              font-size: clamp(0.625rem, 2vw, 0.75rem);
          }
  
          .transactions-table .destination {
              max-width: 120px;
          }
      }
  
      @media (max-width: 640px) {
          .tab-buttons {
              background: transparent;
              padding: clamp(0.125rem, 0.5vw, 0.25rem);
              gap: clamp(0.125rem, 0.5vw, 0.25rem);
              margin-bottom: clamp(0.5rem, 2vw, 0.75rem);
          }
  
          .tab-button {
              padding: clamp(0.25rem, 1vw, 0.375rem);
              font-size: clamp(0.5rem, 1.75vw, 0.625rem);
              border-radius: calc(var(--border-radius) * 0.5);
              background: #f3f4f6;
          }
  
          .tab-button.active {
              background: var(--primary);
              color: white;
              box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
          }
  
          .tab-indicator {
              width: calc(33.33% - 0.25rem);
              height: calc(100% - 0.25rem);
              left: 0.125rem;
              top: 0.125rem;
          }
  
          .table-container {
              display: none;
          }
  
          .transaction-cards {
              display: flex;
          }
  
          input, textarea, .button {
              font-size: clamp(0.75rem, 2.5vw, 0.875rem);
              padding: clamp(0.5rem, 2vw, 0.75rem);
          }
  
          label {
              font-size: clamp(0.625rem, 2vw, 0.75rem);
          }
  
          .keypair-info p {
              font-size: clamp(0.625rem, 2vw, 0.75rem);
          }
  
          .keypair-info .key-value {
              font-size: clamp(0.5rem, 1.5vw, 0.625rem);
          }
      }
  
      @media (max-width: 480px) {
          body {
              padding: clamp(0.25rem, 2vw, 0.5rem);
          }
  
          .container {
              border-radius: calc(var(--border-radius) * 0.75);
          }
  
          .header {
              padding: clamp(0.5rem, 3vw, 1rem);
          }
  
          h1 {
              font-size: clamp(1rem, 4vw, 1.25rem);
          }
  
          h2 {
              font-size: clamp(0.875rem, 3.5vw, 1rem);
          }
  
          .logo {
              width: clamp(1.5rem, 8vw, 2rem);
              height: clamp(1.5rem, 8vw, 2rem);
              font-size: clamp(0.75rem, 4vw, 1rem);
          }
  
          .result {
              padding: clamp(0.375rem, 1.5vw, 0.5rem);
              font-size: clamp(0.625rem, 2vw, 0.75rem);
          }
      }
  </style>
</head>
<body>
    <div class="container" role="main">
        <div class="header" aria-label="Application header">
            <div class="logo">Ï€</div>
            <h1>Pi Network Time-Locked Bot</h1>
        </div>
        <div class="tab-container">
            <div class="tab-buttons" role="tablist">
                <button class="tab-button active" data-tab="derive-keypair" role="tab" aria-selected="true" aria-controls="derive-keypair">Derive Keypair</button>
                <button class="tab-button" data-tab="send-payment" role="tab" aria-selected="false" aria-controls="send-payment">Send Payment</button>
                <button class="tab-button" data-tab="scheduled-transactions" role="tab" aria-selected="false" aria-controls="scheduled-transactions">Scheduled Transactions</button>
                <div class="tab-indicator"></div>
            </div>
            <div class="tab-content active" id="derive-keypair" role="tabpanel">
                <form id="keypairForm" aria-label="Derive keypair form">
                    <label for="mnemonic">Mnemonic Passphrase</label>
                    <textarea id="mnemonic" name="mnemonic" required placeholder="Enter your 24-word mnemonic passphrase" aria-required="true"></textarea>
                    <button type="submit" class="button">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
                        Derive Keypair
                    </button>
                </form>
                <div class="loading" id="keypairLoading" aria-live="polite"><div class="loading-spinner"></div></div>
                <div class="result" id="keypairResult" aria-live="polite"></div>
            </div>
            <div class="tab-content" id="send-payment" role="tabpanel">
                <form id="paymentForm" aria-label="Send payment form">
                    <label for="destination_address">Destination Wallet Address</label>
                    <input type="text" id="destination_address" name="destination_address" required placeholder="Starts with G" aria-required="true">
                    <label for="secret_key">Your Secret Key</label>
                    <input type="text" id="secret_key" name="secret_key" required placeholder="Starts with S" aria-required="true">
                    <label for="amount">Payment Amount (PI)</label>
                    <input type="number" id="amount" name="amount" step="0.0000001" min="0.0000001" required placeholder="e.g., 10.0000001" aria-required="true">
                    <div class="checkbox-container">
                        <input type="checkbox" id="schedule" name="schedule" aria-label="Schedule transaction">
                        <label for="schedule">Schedule Transaction (WAT, UTC+1)</label>
                    </div>
                    <label for="datetime">Schedule Date/Time (WAT, UTC+1)</label>
                    <input type="datetime-local" id="datetime" name="datetime" aria-required="false">
                    <button type="submit" class="button">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
                        Send Payment
                    </button>
                </form>
                <div class="loading" id="paymentLoading" aria-live="polite"><div class="loading-spinner"></div></div>
                <div class="result" id="paymentResult" aria-live="polite"></div>
            </div>
            <div class="tab-content" id="scheduled-transactions" role="tabpanel">
                <h2>Scheduled Transactions</h2>
                <div class="loading" id="transactionsLoading" aria-live="polite"><div class="loading-spinner"></div></div>
                <div class="result" id="transactionsResult" aria-live="polite"></div>
                <div class="table-container" aria-label="Scheduled transactions table">
                    <table class="transactions-table" id="transactionsTable">
                        <thead>
                            <tr>
                                <th scope="col">Destination</th>
                                <th scope="col">Amount (PI)</th>
                                <th scope="col">Scheduled Time (WAT)</th>
                                <th scope="col">Status</th>
                                <th scope="col">Details</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
                <div class="transaction-cards" id="transactionCards" aria-label="Scheduled transactions cards"></div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Tab switching
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');

            console.log(`Found ${tabButtons.length} tab buttons and ${tabContents.length} tab contents`);

            if (tabButtons.length === 0) {
                console.error('No tab buttons found. Check the .tab-button class in the HTML.');
            }
            if (tabContents.length === 0) {
                console.error('No tab contents found. Check the .tab-content class in the HTML.');
            }

            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    console.log(`Tab button clicked: ${button.dataset.tab}`);

                    tabButtons.forEach(btn => {
                        btn.classList.remove('active');
                        btn.setAttribute('aria-selected', 'false');
                    });
                    tabContents.forEach(content => content.classList.remove('active'));

                    button.classList.add('active');
                    button.setAttribute('aria-selected', 'true');

                    const tabContent = document.getElementById(button.dataset.tab);
                    if (tabContent) {
                        tabContent.classList.add('active');
                        console.log(`Activated tab content: ${button.dataset.tab}`);
                    } else {
                        console.error(`Tab content with ID "${button.dataset.tab}" not found.`);
                    }

                    if (button.dataset.tab === 'scheduled-transactions') {
                        console.log('Loading scheduled transactions...');
                        loadScheduledTransactions();
                    }
                });
            });

            // Keypair Form Submission
            const keypairForm = document.getElementById('keypairForm');
            const keypairResult = document.getElementById('keypairResult');
            const keypairLoading = document.getElementById('keypairLoading');

            keypairForm.addEventListener('submit', async (e) => {
                e.preventDefault();

                keypairResult.style.display = 'none';
                keypairResult.className = 'result';
                keypairResult.innerHTML = '';
                keypairLoading.style.display = 'block';

                const mnemonic = document.getElementById('mnemonic').value.trim();
                const wordCount = mnemonic.split(/\s+/).filter(word => word).length;

                if (wordCount !== 24) {
                    showKeypairError('Mnemonic must be 24 words.');
                    return;
                }

                try {
                    const response = await fetch('https://sudden-blair-defidevrel-ba9f6917.koyeb.app/derive_keypair', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ mnemonic })
                    });

                    const data = await response.json();

                    if (response.ok) {
                        const accountStatusClass = data.account_status === 'ACTIVE' ? 'badge-active' : 'badge-inactive';
                        showKeypairSuccess(`
                            <p>Keypair derived successfully!</p>
                            <div class="keypair-info">
                                <p>
                                    <strong>Public Key</strong>
                                    <div class="flex-row">
                                        <span class="key-value">${data.public_key}</span>
                                        <span class="tooltip" onclick="copyToClipboard('${data.public_key}')">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="copy-icon" aria-hidden="true"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                                            <span class="tooltiptext">Copy to clipboard</span>
                                        </span>
                                    </div>
                                </p>
                                <p>
                                    <strong>Secret Key</strong>
                                    <div class="flex-row">
                                        <span class="key-value">${data.secret_key}</span>
                                        <span class="tooltip" onclick="copyToClipboard('${data.secret_key}', true)">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="copy-icon" aria-hidden="true"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                                            <span class="tooltiptext">Copy to clipboard</span>
                                        </span>
                                    </div>
                                </p>
                                <p>
                                    <strong>Account Status</strong>
                                    <span class="key-value">${data.account_status} <span class="badge ${accountStatusClass}">${data.account_status}</span></span>
                                </p>
                                <button class="button button-success" onclick="copyToClipboard('${data.secret_key}', true)">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                                    Copy Secret Key & Use for Payment
                                </button>
                            </div>
                        `);
                    } else {
                        showKeypairError(data.error || 'An error occurred while deriving the keypair.');
                    }
                } catch (error) {
                    showKeypairError(`Network error: ${error.message}`);
                } finally {
                    keypairLoading.style.display = 'none';
                }
            });

            // Payment Form Submission
            const paymentForm = document.getElementById('paymentForm');
            const paymentResult = document.getElementById('paymentResult');
            const paymentLoading = document.getElementById('paymentLoading');
            const scheduleCheckbox = document.getElementById('schedule');
            const datetimeInput = document.getElementById('datetime');

            scheduleCheckbox.addEventListener('change', () => {
                datetimeInput.style.display = scheduleCheckbox.checked ? 'block' : 'none';
                datetimeInput.required = scheduleCheckbox.checked;
            });

            paymentForm.addEventListener('submit', async (e) => {
                e.preventDefault();

                paymentResult.style.display = 'none';
                paymentResult.className = 'result';
                paymentResult.innerHTML = '';
                paymentLoading.style.display = 'block';

                const destinationAddress = document.getElementById('destination_address').value.trim();
                const secretKey = document.getElementById('secret_key').value.trim();
                const amount = parseFloat(document.getElementById('amount').value);
                const datetime = datetimeInput.value;
                const isScheduled = scheduleCheckbox.checked;

                if (!destinationAddress.startsWith('G')) {
                    showPaymentError('Destination address must start with "G".');
                    return;
                }
                if (!secretKey.startsWith('S')) {
                    showPaymentError('Secret key must start with "S".');
                    return;
                }
                if (amount <= 0) {
                    showPaymentError('Amount must be greater than 0.');
                    return;
                }
                if (isScheduled && !datetime) {
                    showPaymentError('Please select a date and time for scheduling.');
                    return;
                }
                if (isScheduled) {
                    const now = new Date();
                    const selectedDate = new Date(datetime);
                    if (selectedDate <= now) {
                        showPaymentError('Scheduled time must be in the future.');
                        return;
                    }
                }

                const endpoint = isScheduled ? '/schedule_payment' : '/send_payment';
                const payload = isScheduled
                    ? { destination_address: destinationAddress, secret_key: secretKey, amount, datetime }
                    : { destination_address: destinationAddress, secret_key: secretKey, amount };

                try {
                    const response = await fetch(`https://sudden-blair-defidevrel-ba9f6917.koyeb.app${endpoint}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    const data = await response.json();

                    if (response.ok) {
                        showPaymentSuccess(`
                            <p>${data.message || 'Transaction successful!'}</p>
                            ${data.transaction ? `
                            <div class="keypair-info">
                                <p>
                                    <strong>Transaction Hash</strong>
                                    <div class="flex-row">
                                        <span class="key-value">${data.transaction.hash}</span>
                                        <span class="tooltip" onclick="copyToClipboard('${data.transaction.hash}')">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="copy-icon" aria-hidden="true"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                                            <span class="tooltiptext">Copy to clipboard</span>
                                        </span>
                                    </div>
                                </p>
                            </div>
                            ` : ''}
                        `);
                    } else {
                        showPaymentError(data.error || 'An error occurred during the transaction.');
                        if (data.details) {
                            paymentResult.innerHTML += `<br><div class="keypair-info"><pre style="overflow-x: auto; font-size: clamp(0.625rem, 2vw, 0.75rem);">${JSON.stringify(data.details, null, 2)}</pre></div>`;
                        }
                    }
                } catch (error) {
                    showPaymentError(`Network error: ${error.message}`);
                } finally {
                    paymentLoading.style.display = 'none';
                }
            });

            // Load Scheduled Transactions
            async function loadScheduledTransactions() {
                const transactionsTableBody = document.querySelector('#transactionsTable tbody');
                const transactionCards = document.getElementById('transactionCards');
                const transactionsResult = document.getElementById('transactionsResult');
                const transactionsLoading = document.getElementById('transactionsLoading');

                transactionsResult.style.display = 'none';
                transactionsResult.className = 'result';
                transactionsResult.innerHTML = '';
                transactionsLoading.style.display = 'block';
                transactionsTableBody.innerHTML = '';
                transactionCards.innerHTML = '';

                try {
                    const response = await fetch('https://sudden-blair-defidevrel-ba9f6917.koyeb.app/get_scheduled_transactions', {
                        method: 'GET',
                        headers: { 'Content-Type': 'application/json' }
                    });

                    const data = await response.json();

                    if (response.ok) {
                        if (data.transactions.length === 0) {
                            transactionsResult.className = 'result';
                            transactionsResult.innerHTML = 'No scheduled transactions found.';
                            transactionsResult.style.display = 'block';
                        } else {
                            data.transactions.forEach(tx => {
                                const statusClass = tx.status.toLowerCase() === 'pending' || tx.status.toLowerCase() === 'completed'
                                    ? `badge-${tx.status.toLowerCase()}`
                                    : `badge-${tx.status.toLowerCase()}`;
                                const row = document.createElement('tr');
                                row.innerHTML = `
                                    <td class="destination">${tx.destination_address}</td>
                                    <td>${tx.amount.toFixed(7)}</td>
                                    <td>${tx.scheduled_time_wat}</td>
                                    <td class="status"><span class="badge ${statusClass}">${tx.status.toLowerCase()}</span></td>
                                    <td>
                                        ${tx.transaction_hash ? `
                                        <div class="flex-row">
                                            <span class="key-value">${tx.transaction_hash.substring(0, 10)}...</span>
                                            <span class="tooltip" onclick="copyToClipboard('${tx.transaction_hash}')">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="copy-icon" aria-hidden="true"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                                                <span class="tooltiptext">Copy to clipboard</span>
                                            </span>
                                        </div>
                                        ` : tx.error_message || '-'}
                                    </td>
                                `;
                                transactionsTableBody.appendChild(row);

                                const card = document.createElement('div');
                                card.className = 'transaction-card';
                                card.innerHTML = `
                                    <div class="transaction-card-row">
                                        <span class="transaction-card-label">Status:</span>
                                        <span class="transaction-card-value"><span class="badge ${statusClass}">${tx.status.toLowerCase()}</span></span>
                                    </div>
                                    <div class="transaction-card-row">
                                        <span class="transaction-card-label">Destination:</span>
                                        <span class="transaction-card-value">${tx.destination_address.substring(0, 15)}...</span>
                                    </div>
                                    <div class="transaction-card-row">
                                        <span class="transaction-card-label">Amount:</span>
                                        <span class="transaction-card-value">${tx.amount.toFixed(7)} PI</span>
                                    </div>
                                    <div class="transaction-card-row">
                                        <span class="transaction-card-label">Scheduled:</span>
                                        <span class="transaction-card-value">${tx.scheduled_time_wat}</span>
                                    </div>
                                    ${tx.transaction_hash ? `
                                    <div class="transaction-card-row">
                                        <span class="transaction-card-label">Hash:</span>
                                        <span class="transaction-card-value">
                                            ${tx.transaction_hash.substring(0, 10)}...
                                            <span class="tooltip" onclick="copyToClipboard('${tx.transaction_hash}')">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="copy-icon" aria-hidden="true"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 1 1 2 2v1"></path></svg>
                                                <span class="tooltiptext">Copy to clipboard</span>
                                            </span>
                                        </span>
                                    </div>
                                    ` : tx.error_message ? `
                                    <div class="transaction-card-row">
                                        <span class="transaction-card-label">Error:</span>
                                        <span class="transaction-card-value">${tx.error_message}</span>
                                    </div>
                                    ` : ''}
                                `;
                                transactionCards.appendChild(card);
                            });
                        }
                    } else {
                        transactionsResult.className = 'result error';
                        transactionsResult.innerHTML = data.error || 'An error occurred while fetching transactions.';
                        transactionsResult.style.display = 'block';
                    }
                } catch (error) {
                    transactionsResult.className = 'result error';
                    transactionsResult.innerHTML = `Network error: ${error.message}`;
                    transactionsResult.style.display = 'block';
                } finally {
                    transactionsLoading.style.display = 'none';
                }
            }

            // Helper Functions
            function showKeypairSuccess(html) {
                keypairResult.className = 'result success';
                keypairResult.innerHTML = html;
                keypairResult.style.display = 'block';
            }

            function showKeypairError(message) {
                keypairResult.className = 'result error';
                keypairResult.innerHTML = message;
                keypairResult.style.display = 'block';
                keypairLoading.style.display = 'none';
            }

            function showPaymentSuccess(message) {
                paymentResult.className = 'result success';
                paymentResult.innerHTML = message;
                paymentResult.style.display = 'block';
            }

            function showPaymentError(message) {
                paymentResult.className = 'result error';
                paymentResult.innerHTML = message;
                paymentResult.style.display = 'block';
                paymentLoading.style.display = 'none';
            }

            function copyToClipboard(text, autoFill = false) {
                navigator.clipboard.writeText(text).then(() => {
                    if (autoFill) {
                        document.getElementById('secret_key').value = text;
                        document.querySelector('.tab-button[data-tab="send-payment"]').click();
                    }

                    const tooltip = document.createElement('div');
                    tooltip.textContent = 'Copied to clipboard!';
                    tooltip.style.position = 'fixed';
                    tooltip.style.top = '20px';
                    tooltip.style.left = '50%';
                    tooltip.style.transform = 'translateX(-50%)';
                    tooltip.style.padding = '8px 16px';
                    tooltip.style.background = '#374151';
                    tooltip.style.color = 'white';
                    tooltip.style.borderRadius = '8px';
                    tooltip.style.zIndex = '1000';
                    tooltip.style.fontSize = 'clamp(0.75rem, 2.5vw, 0.875rem)';
                    tooltip.style.fontWeight = '500';
                    document.body.appendChild(tooltip);

                    setTimeout(() => {
                        tooltip.style.opacity = '0';
                        tooltip.style.transition = 'opacity 0.5s ease';
                        setTimeout(() => document.body.removeChild(tooltip), 500);
                    }, 2000);
                }).catch(err => {
                    alert('Failed to copy: ' + err);
                });
            }

            // Responsive view toggle
            function checkMobileView() {
                const isMobile = window.innerWidth <= 640;
                const tableContainer = document.querySelector('.table-container');
                const transactionCards = document.querySelector('.transaction-cards');
                tableContainer.style.display = isMobile ? 'none' : 'block';
                transactionCards.style.display = isMobile ? 'flex' : 'none';
            }

            window.addEventListener('load', checkMobileView);
            window.addEventListener('resize', checkMobileView);
        });
    </script>
</body>
</html>